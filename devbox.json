{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.12.0/.schema/devbox.schema.json",
  "packages": [
    "python@3.12.4",
    // Used by tensorflow
    //"stdenv.cc.cc.lib",
    "github:GuillaumeDesforges/fix-python/",
    "poetry@1.8.3",
    "stdenv@latest"
  ],
  "env": {
    "VENV_DIR": ".venv"
  },
  "shell": {
    "init_hook": [
      "alias pytest=\"poetry run pytest\"",
     "alias python=\"poetry run python\"",
      "alias python3=\"poetry run python\"",
      "alias py=\"poetry run python\"",
      "alias py3=\"poetry run python\"",
      // Change library path for tensorflow so it can import C++ library
      "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:./.devbox/nix/profile/default/lib",
      "poetry install",

       "if git diff --name-only HEAD~1 HEAD | grep -q 'poetry.lock'; then",
      "    echo \"poetry.lock was modified, fixing python paths...\"", 
      // Python modules assume path for C/C++ libraries, use fix-python to change link
      "    fix-python --venv .venv --libs .nix/libs.nix &> /dev/null",
      "fi"
    ],
    "scripts": {}
  }
}
