{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.12.0/.schema/devbox.schema.json",
  "packages": [
    "python@3.12.4",
    // Used by tensorflow
    "stdenv.cc.cc.lib",
    "black@24.4.2",
    "github:GuillaumeDesforges/fix-python/"
  ],
  "env": {
    "VENV_DIR": ".venv"
  },
  "shell": {
    "init_hook": [
      ". $VENV_DIR/bin/activate",
      // Check if requirements.txt was modified in the latest commit
      "if git diff -U0 requirements.txt | grep -q 'requirements.txt'; then",
      "    echo \"requirements.txt was modified. Installing dependencies...\"",
      "    pip install -r requirements.txt -q",
      // Python modules assume path for C/C++ libraries, use fix-python to change link
      "    echo \"Fixing python paths...\"",
      "    fix-python --venv .venv --libs .nix/libs.nix &> /dev/null",
      "else",
      "    echo \"requirements.txt was not modified. Skipping dependency installation.\"",
      "fi",
      // Change library path for tensorflow so it can import C++ library
      "export LD_LIBRARY_PATH=./.devbox/nix/profile/default/lib64:$LD_LIBRARY_PATH"
    ],
    "scripts": {}
  }
}